<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="John Doe" />
  <meta name="description" content="" />
  
  
  <title>
    
      入侵检测设备 
      
      
      |
    
     Hexo
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>

<meta name="generator" content="Hexo 6.0.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Oranges</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">入侵检测设备</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="Update time"></i>
          2023-09-24 08:12:56
        </span>
        
      </div>
      <div class="markdown-body">
        <h1 id="1天眼"><a href="#1天眼" class="headerlink" title="1天眼"></a>1天眼</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>高级威胁检测，检测流量中的攻击</p>
<p>是<strong>全流量设备</strong>，并非全包流量【因探针只记录部分流量】</p>
<p>安全合规审计，通过内置场景进行，如高危端口访问审计【22端口：ssh应用端口 53端口：DNS（Domain Name Server，域名服务器）服务器所开放】</p>
<h2 id="产品介绍"><a href="#产品介绍" class="headerlink" title="产品介绍"></a>产品介绍</h2><p>天眼=IDS+WAF+数据库审计系统+上网行为审计+内部合规审计</p>
<p>可以联动天擎（用来在内网下线终端、查杀病毒）、防火墙（用于在边界封禁ip）</p>
<h2 id="威胁检测机制与日志留存机制"><a href="#威胁检测机制与日志留存机制" class="headerlink" title="威胁检测机制与日志留存机制"></a>威胁检测机制与日志留存机制</h2><p>a.天眼同时检测攻击<strong>请求</strong>报文和攻击<strong>响应</strong>报文，能够给出攻击结果的精准判断：企图（虽状态码为200，但没有匹配到特征库）、成功、失陷、失败。<br>b.结合本地流量及云端大数据威胁情报进行检测。<br>c.对网络中传输的文件进行还原，基于沙箱的<strong>静态及动态检测</strong>可以检测通过网络传播的恶意文件。<br>d.天眼同时记录攻击<strong>告警日志及网络会话日志</strong>，可以准确还原告警发生时的上下文网络会话。<br>e.能对历史网络流量进行回滚分析和检测，从而发现早期已经潜伏在网络中的攻击。</p>
<p><a target="_blank" rel="noopener" href="https://172.168.20.232/sensor/home">https://172.168.20.232/sensor/home</a></p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>三个重要组件（流量传感器、文件威胁鉴定器、分析平台）</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/3.png" style="zoom:80%;"></p>
<h3 id="流量传感器【探针】"><a href="#流量传感器【探针】" class="headerlink" title="流量传感器【探针】"></a>流量传感器【探针】</h3><p>（1）采集与还原流量信息【数据还原配置模块：探针可以还原qq、http、imip信息，不支持微信流量的还原】，还原应用协议信息，记录文件传输行为、邮件行为与数据库行为，检测入侵行为与web攻击行为。</p>
<p>（2）探针属于<strong>旁路</strong>部署的<strong>模式</strong>，一般部署在核心交换机旁侧</p>
<p>（3）探针旁路阻断的三种方式：①URL重定向：http_redirect、②IP阻断：tcp_reset、③DNS重定向：dns_redirect</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/4.png" alt></p>
<p>（4）需要采集流量，要有监听口，而文件威胁鉴定器和分析平台不用（不需要采集流量）。</p>
<p>（5）通过流量过滤功能，去实现ip过滤、网段过滤，从而减轻服务器层压。</p>
<p>（6）存在白名单，对于流量传感器中的加白日志，不会发送到分析平台。</p>
<p>（7）有XFF字段的提取，一般提取第一个值用来检测真正的攻击。对目前所有的告警都可以生效，只要使用http协议（webshell类攻击、网络攻击、网页漏洞利用、威胁情报），都可以提取XFF字段。根据http转发头，识别真正的客户端ip。</p>
<p><strong>【只存储</strong>告警日志<strong>】，根据七层协议还原流量。若匹配到规则库，则</strong>生成告警日志**，否则生成网络日志，将两种日志一起传给分析平台。</p>
<h3 id="文件威胁鉴定器【沙箱】"><a href="#文件威胁鉴定器【沙箱】" class="headerlink" title="文件威胁鉴定器【沙箱】"></a><strong>文件威胁鉴定器</strong>【沙箱】</h3><p>文件来源方式：探针发送过来、自己提交的【四种方式：手动提交、URL提交、HTTP提交、SMB提交】</p>
<p>分为文件静态检测（检测文件的md5值、签名、漏洞）和动态检测（通过内置虚拟机检测异常检测等），分析文件行为，将生成的<strong>样本日志</strong>传给分析平台。</p>
<h3 id="分析平台"><a href="#分析平台" class="headerlink" title="分析平台"></a>分析平台</h3><p>（1）可以作为数据库存储日志。在当前最新版本中，分析平台只能存储告警日志【来源于沙箱与探针】、网络日志【来源于沙箱，不存在恶意行为】，将这些日志存储在ES中。</p>
<p>（2）利用第三方中间价nginx提供web服务。</p>
<p>（3）具有级联功能，涉及到的级联通讯端口有8089、8099、443三个端口。</p>
<p>（4）内置4T（12块数据盘），如数据盘sda【用于装操作系统】、sdb【用于集群】（若集群状态异常，一般都是数据盘sdb被损坏）、sdc等。</p>
<p>（5）属于应用软件，不能直接运行在裸机上，应用需要操作系统（centos6）的支持。</p>
<p>（6）相对前两个而言，性能最好。</p>
<p>（7）功能：分析平台的白名单。加白后告警不会存在于威胁感知界面，但在日志检索界面仍然存在，即仍然存在于分析平台。</p>
<p>（8）分析平台在配置时，满足四个条件（时间、版本团体字、161、7755）：</p>
<p>要求三个平台时间需一致，否则可能会导致日志发送不过来；</p>
<p>SNMP配置（版本、和三个组件之间团体字）需要一致且161端口需要放行，否则存活状态会出现异常。因为SNMP（使用UDP的161端口进行探测）主要用于探测网络（三个组件）之间存活的状态。此外，7755端口在探测存活时也会发挥作用，分析平台和流量传感器之间用到的7755端口需要开放，否则也会产生异常。</p>
<p>威胁感知系统：基于云端情报的木马发现机制、展示本地已经遭受入侵的IP；回溯搜索：对历史被攻击情况的回溯，能够对本地镜像流量进行大数据存储和检索。</p>
<p>终端日志【天擎发送过来】，可与天擎进行联动。</p>
<h3 id="三个硬件"><a href="#三个硬件" class="headerlink" title="三个硬件"></a>三个硬件</h3><p>S53/S56【安装流量传感器服务器，对应流量传感器】用于部署探针（旁路部署）【还有一个硬件型号：S52】含四个监听口用于采集流量，两个USB口。</p>
<p>A58【对应分析平台】/D57【对应文件威胁鉴定器】用于部署分析平台和沙箱</p>
<h3 id="注"><a href="#注" class="headerlink" title="注"></a>注</h3><p>（1）日志检索模块中存在三个模式：高级模式、专家模式、快捷模式（实现胶囊式的填充），只能在前两个模式输入日志检索语句。</p>
<p>（2）天眼分析平台允许导出的报表格式：docx文档、pdf、html。</p>
<p>（3）分析平台收不到流量传感器发送的日志，此时有三种情况：</p>
<p>时间不一致导致日志未发送过来；</p>
<p>流量传感器和分析平台之间是否存在数据传输的加密，若有，此时加密方式不一致或加密密钥不一样，也可能导致分析平台收不到日志；</p>
<p>流量传感器想要发送日志，需要配置日志外发、且7755端口需开放，否则收不到日志。</p>
<p>（4）天眼的IP：本身存在ES的IP、管理口的IP、日志接收组件的IP。</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/1.png" style="zoom:67%;"></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/2.png"></p>
<p>端口的使用：</p>
<p>流量传感器-沙箱：6666  流量传感器-分析平台：7755  沙箱-分析平台：9955</p>
<p>组件（服务）：</p>
<p>云端威胁情报</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>VPN下载</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/5.png" style="zoom:80%;"></p>
<p>分析平台中</p>
<p>系统信息栏——系统版本开头数字4.3只是说明所属主体不同，而版本是一致的</p>
<p>设备管理栏——探针分为天眼探针和NDS探针（天堤）。其中，NDS探针异常有两种可能，一是自身机制原因（超过五分钟没有数据发送，NDS便会提示离线），二是确实存在网络原因。</p>
<h1 id="2日志检索语法"><a href="#2日志检索语法" class="headerlink" title="2日志检索语法"></a>2日志检索语法</h1><h2 id="2-1基本搜索语法"><a href="#2-1基本搜索语法" class="headerlink" title="2.1基本搜索语法"></a>2.1基本搜索语法</h2><p><strong>构成三要求：</strong></p>
<p>字段 项 运算符</p>
<p><strong>语法：</strong></p>
<p>字段:项 运算符 字段:项（注意：运算符一定要大写！！但字段和项可大写可小写）<br><strong>运算符：</strong></p>
<p>AND 运算符（AND、&amp;&amp; 或 +）、OR 运算符（OR 或 ||）、NOT 运算符（NOT、! 或 -）</p>
<p><strong>项：</strong></p>
<p>项（单词），短语（””）,分组（优先运算符-将字符串括在括号 ( ) 中）<br><strong>字段：</strong></p>
<p>通用字段：sip（源ip）,dip（目的ip）,dport（目的端口）,sport，serial_num<br>协议字段： sql_info（存储sql语句），up_payload（上行100字节），proto，dns_type（dns_type:0，表示域名<strong>请求</strong>解析;dns_type:1，表示域名解析的<strong>响应</strong>），addr（DNS的A记录），uri，status, method，agent，data，server_name,attach_md5,db_type,normal_ret, ret_code,host</p>
<p>另：</p>
<p>host 域名   client_os 客户操作系统</p>
<p>全文搜索——在搜索栏输入，检索全日志，不建议使用。</p>
<h3 id="练习一"><a href="#练习一" class="headerlink" title="练习一"></a>练习一</h3><p>查询时间在语句最右边</p>
<p>访问80端口说明web访问</p>
<p>sip:”” AND dip:”” AND dport:8080</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/7.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/9.png" alt></p>
<p>索引类型web访问 不能出现两个源ip</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/10.png" alt></p>
<h3 id="练习二"><a href="#练习二" class="headerlink" title="练习二"></a>练习二</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/32.png" alt></p>
<h2 id="2-2高级检索"><a href="#2-2高级检索" class="headerlink" title="2.2高级检索"></a>2.2高级检索</h2><h3 id="2-2-1通配符"><a href="#2-2-1通配符" class="headerlink" title="2.2.1通配符"></a>2.2.1通配符</h3><p>?匹配单个字符</p>
<p>*匹配0到多个字符</p>
<p>注意：通配符?*不能用作检索数字，使用时不允许使用双引号</p>
<h4 id="练习一-1"><a href="#练习一-1" class="headerlink" title="练习一"></a>练习一</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/31.png" alt></p>
<h4 id="练习二-1"><a href="#练习二-1" class="headerlink" title="练习二"></a>练习二</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/28.png" alt></p>
<p>data指的是请求体字段</p>
<h3 id="2-2-2范围检索"><a href="#2-2-2范围检索" class="headerlink" title="2.2.2范围检索"></a>2.2.2范围检索</h3><p>[]包含端点值 {}不包含端点值 无()小括号为优先运算符</p>
<p>括号内一定要含关键字TO，且一定要大写</p>
<p>可以混合使用。也可写作：&gt;、&lt;、&lt;=、&gt;=。</p>
<h4 id="练习一-2"><a href="#练习一-2" class="headerlink" title="练习一"></a>练习一</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/11.png" alt></p>
<p>响应码、状态码字段名那为status</p>
<h4 id="练习二-2"><a href="#练习二-2" class="headerlink" title="练习二"></a>练习二</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/8.png" style="zoom:80%;"></p>
<p>head一般做目录的扫描，探测是否存在</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/12.png" alt></p>
<p>查询网段可以直接写网段，若是某个范围只能用范围检索去写</p>
<h3 id="2-2-3模糊搜索"><a href="#2-2-3模糊搜索" class="headerlink" title="2.2.3模糊搜索"></a>2.2.3模糊搜索</h3><p>（~），项的末尾使用波浪符号，即可执行模糊搜索。即使搜索项拼错或仅指定部分单词也找出匹配项的搜索（使用时不能加双引号！）</p>
<p>在全日志搜索会影响搜索效率</p>
<h3 id="2-2-4近似搜索"><a href="#2-2-4近似搜索" class="headerlink" title="2.2.4近似搜索"></a>2.2.4近似搜索</h3><p>短语后面加上（~），可以搜到被隔开或顺序不同的单词</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/29.png" alt></p>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/30.png" alt></p>
<h3 id="2-2-5正则搜索、转义搜索、二级检索"><a href="#2-2-5正则搜索、转义搜索、二级检索" class="headerlink" title="2.2.5正则搜索、转义搜索、二级检索"></a>2.2.5正则搜索、转义搜索、二级检索</h3><p>正则搜索：性能较差，一般不用</p>
<p>转义搜索：转义特殊字符。当搜索时含特殊字符，加上反斜杠\用于转义。</p>
<p>二级检索：在原有搜索语句进行二次搜索，即可在选定字段上创建新的搜索语句进行搜索</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>a.范围要精确<br>b.尽量使用字段搜索（模糊搜索会在全日志里面匹配，速度和精确度大大下降）<br>c.通配符不要用于数字的检索，使用通配符时不能加双引号<br>d.使用模糊搜索时不能加双引号<br>e.范围检索可用于搜索数值 / 时间 / IP 类型的字段<br>f.关键字尽量不要包含特殊符号</p>
<h2 id="2-3字段"><a href="#2-3字段" class="headerlink" title="2.3字段"></a>2.3字段</h2><h3 id="网络协议公共字段"><a href="#网络协议公共字段" class="headerlink" title="网络协议公共字段"></a>网络协议公共字段</h3><p>传感器序列号 serial_num区分是由哪个探针发送过来</p>
<h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p>传输具有稳定性和可靠性</p>
<p>三次握手建立连接 四次挥手</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/13.png" alt></p>
<h4 id="练习一-3"><a href="#练习一-3" class="headerlink" title="练习一"></a>练习一</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/33.png" alt></p>
<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p>不可靠，传输速度更快，不管接收方是否接收到数据</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/14.png" alt></p>
<p>但是tcp和udp属于传输层协议，通过hex编码传输</p>
<p>mac地址是同一个广播域内有效</p>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>用于域名解析，两种解析方式：递归和迭代</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/15.png" alt></p>
<p>天眼无url字段，故拆分为proto+host+uri</p>
<p>proto:http（web访问一般为http协议）</p>
<p>host:www.163.com</p>
<p>uri:统一资源标识符/index.html</p>
<p>递归查询（了解，少见，本地DNS和客户机之间存在即用于内网中）</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/17.png" alt></p>
<p>ip地址是定位互联网资源的唯一标识</p>
<p>迭代查询</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/16.png" alt></p>
<p>本地DNS服务器：查找自身缓存、查找</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/18.png" alt></p>
<p>dns_type</p>
<p>客户端、本地DNS服务器可以发起DNS请求（为源ip）</p>
<p>本地DNS服务器（接收客户端请求）、根域名服务器、顶级域名服务器、权限域名服务器（接收本地DNS服务器请求）接收DNS请求（为目的ip）</p>
<p>addr</p>
<p>已知域名解析ip，A记录ipv4</p>
<p>已知ip解析域名，PTR记录域名</p>
<p>cname</p>
<p>记录别名</p>
<p>练习1</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/19.png" alt></p>
<p>域名解析结果——A记录一般在响应包中，dns_type=1</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/20.png" alt></p>
<h3 id="文件传输协议"><a href="#文件传输协议" class="headerlink" title="文件传输协议"></a>文件传输协议</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/21.png" alt></p>
<p>file_dir</p>
<p>服务端传给客户端是下载，由此确定受害ip</p>
<h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><p>请求包（请求头+请求体）</p>
<p>请求头：（请求方法）GET+uti+http版本号、host、Referer、cookie</p>
<p>响应包（响应头+响应体）</p>
<p>响应头：http版本号+相应/状态码【2+为成功】</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/22.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/23.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/24.png" alt></p>
<p>返回302时一般有一个字段location，说明被重定向到哪个页面</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/25.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/26.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/27.png" alt></p>
<p>data表示请求体的内容，1000字节是浏览器的要求</p>
<h3 id="SSL协议"><a href="#SSL协议" class="headerlink" title="SSL协议"></a>SSL协议</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/34.png" alt></p>
<h3 id="邮件协议"><a href="#邮件协议" class="headerlink" title="邮件协议"></a>邮件协议</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/35.png" alt></p>
<h4 id="练习一-4"><a href="#练习一-4" class="headerlink" title="练习一"></a>练习一</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/36.png" alt></p>
<h3 id="登录协议"><a href="#登录协议" class="headerlink" title="登录协议"></a>登录协议</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/37.png" alt></p>
<h4 id="练习一-5"><a href="#练习一-5" class="headerlink" title="练习一"></a>练习一</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/38.png" alt></p>
<h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/39.png" alt></p>
<p>normal_ret</p>
<h4 id="练习一-6"><a href="#练习一-6" class="headerlink" title="练习一"></a>练习一</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/40.png" alt></p>
<h4 id="练习二-六"><a href="#练习二-六" class="headerlink" title="练习二-六"></a>练习二-六</h4><p>1、检索192.168.1.0/24网段访问10.0.0.1的tcp流量。<br>   左侧已选中tcp.流量，请直接写出语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sip:192.168.1.0/24 AND dip:10.0.0.1</span><br><span class="line">sip:[192.168.1.1 TO 192.168.1.254] AND dip:10.0.0.1</span><br></pre></td></tr></table></figure>
<p>255为广播地址不作为ip</p>
<p>2、检索192.168.1.1访问10.0.0.1的tcp流量中上行负载[up_payload]包含root 的流量,写出检索对应流量的语法。[Hex(root)= 726F6F74]<br>   左侧已选中tcp.流量，请直接写出语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sip:192.168.1.1 AND dip:10.0.0.1 AND up_payload:*726F6F74*</span><br><span class="line">sip:192.168.1.1 AND dip:10.0.0.1 AND up_payload:root</span><br></pre></td></tr></table></figure>
<p>Hex编码可以加快查询速度</p>
<p>3、检索192.168.1.2和192.168.1.3访问了10.0.0.1的tcp.流量。<br>   左侧已选中tcp流量，请直接写出语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sip:(192.168.1.2 OR 192.168.1.3) AND dip:10.0.0.1</span><br><span class="line">(sip:192.168.1.2 OR sip:192.168.1.3) AND dip:10.0.0.1</span><br><span class="line">(sip:192.168.1.2 AND dip:10.0.0.1) OR (sip:192.168.1.3 AND dip:10.0.0.1)</span><br></pre></td></tr></table></figure>
<p>4、检索访问192.168.1.0/24网段445端口的tcp流量日志。<br>  左侧已选中tcp.流量，请直接写出语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dip:192.1681.0/24 AND dport:445</span><br></pre></td></tr></table></figure>
<p>A（源）访问B（目的ip）</p>
<p>5、检索agent包括[java, sword, wget] 的流量日志。<br>左侧已选中web访问，请直接写出语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">agent:(java OR sword OR wget)</span><br><span class="line">agent:java OR agent:sword OR agent:wget</span><br></pre></td></tr></table></figure>
<p>user-agent字段用于表示扫描器或浏览器信息</p>
<h1 id="3基础知识"><a href="#3基础知识" class="headerlink" title="3基础知识"></a>3基础知识</h1><h2 id="3-1网络模型"><a href="#3-1网络模型" class="headerlink" title="3.1网络模型"></a>3.1网络模型</h2><h3 id="OSI七层网络模型"><a href="#OSI七层网络模型" class="headerlink" title="OSI七层网络模型"></a>OSI七层网络模型</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/41.png" alt></p>
<p>应用层：七层负载均衡设备（做数据的连接转发）</p>
<p>传输层：负载均衡设备（做数据包的转发）</p>
<p>网络层：路由器、三层交换机（有路由功能）</p>
<p>数据链路层：二层交换机</p>
<h3 id="TCP-IP五层模型"><a href="#TCP-IP五层模型" class="headerlink" title="TCP/IP五层模型"></a>TCP/IP五层模型</h3><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/42.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/43.png" alt></p>
<p>应用层：http、https、dns……</p>
<p>传输层：TCP、UDP</p>
<p>网络层：IP、ARP、RARP、ICMP、IGMP协议</p>
<p>数据链路层：以太网协议，交换机</p>
<p>物理层：以太网协议，集线器</p>
<h2 id="3-2NAT协议"><a href="#3-2NAT协议" class="headerlink" title="3.2NAT协议"></a>3.2NAT协议</h2><p>地址转换协议，负责地址转换，访问会话只能由私网主机发起：</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/44.png" alt></p>
<p>静态NAT：一对一映射</p>
<p>动态NAT：多（多个私网ip）对一（同一个公网），节约公网资源</p>
<h2 id="3-3web架构"><a href="#3-3web架构" class="headerlink" title="3.3web架构"></a>3.3web架构</h2><p>web服务器、应用服务器、数据库服务器、负载均衡（四层负载均衡-转发、七层负载均衡-代理）</p>
<p>（1）web服务器部署在前用于处理静态请求（送回一个html页面、txt文档、图片、进行页面跳转），而应用服务器可以处理动态请求（动态的脚本语言：php、jsp），这两个服务器混合部署。</p>
<p>常见的web服务器：Apache、Nginx、IIS，默认端口均为80</p>
<p>（2）常见的应用服务器：JBoss（8080）、Weblogic（7001）、Tomcat（8080），均需要Java环境</p>
<p>（3）数据库服务器：分为关系型数据库【使用SQL语句】MYSQL、MSSQL、Oracle、Postgre（以二维表的形式存储数据）和非关系型数据库【不使用SQL语句】Redis、MongoDB、Elasticsearch（用层次和网状模型）</p>
<p>非关系型数据库可以处理海量数据，但组织数据的关系相对更复杂，不好理解，且不使用通用的SQL语句</p>
<p>（4）负载均衡</p>
<p>四层负载均衡解析至传输层，基于端口转发，工作效率相对高</p>
<p>七层负载均衡基于应用层协议进行转发，更为复杂</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/45.png" style="zoom:80%;"></p>
<h2 id="3-4密码编码学（加密）"><a href="#3-4密码编码学（加密）" class="headerlink" title="3.4密码编码学（加密）"></a>3.4密码编码学（加密）</h2><p>对称密码体制（DES、AES）、非对称密码体制（RSA、椭圆曲线）、单向散列函数（MD5、SHA1、SHA256）、编码（url、base64、hex）</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/46.png" alt></p>
<p>现代密码的保密性不依赖于算法的保密性而是依赖于密钥的保密性</p>
<p>天眼使用AES、RC4均为对称密码</p>
<p>URL编码对于数据和字符不编码，在请求头时使用，以%开头</p>
<h2 id="3-5木马"><a href="#3-5木马" class="headerlink" title="3.5木马"></a>3.5木马</h2><h3 id="远控木马"><a href="#远控木马" class="headerlink" title="远控木马"></a>远控木马</h3><p>木马的全称是特洛伊木马，是一种新型的计算机网络病毒程序，是一种基于远程控制的黑客工具。</p>
<p>第一代木马：1986年PC-Write木马</p>
<p>第二代木马：1986年AIDS木马</p>
<p>第三代木马：网络传播性木马</p>
<p>网络特征：中招后进行恶意域名解析，与CC服务器建立tcp加密连接</p>
<h3 id="挖矿木马"><a href="#挖矿木马" class="headerlink" title="挖矿木马"></a>挖矿木马</h3><p>挖矿：运行特定的计算公式，试图计算出符合特定规则的Hash值</p>
<p>接收攻击指令（横向攻击，DDOS，挖矿，加密信息等）、</p>
<p>上传机器信息（机器名，安全程序名，机器码等）、</p>
<p>下载其他恶意程序或更新自身程序等等。</p>
<h4 id="挖矿方式及交互特征"><a href="#挖矿方式及交互特征" class="headerlink" title="挖矿方式及交互特征"></a>挖矿方式及交互特征</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/48.png" alt></p>
<p>挖矿不是恶意行为</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/49.png" alt></p>
<h4 id="终端挖矿"><a href="#终端挖矿" class="headerlink" title="终端挖矿"></a>终端挖矿</h4><p>终端挖矿会通过域名解析，与解析结果建立tcp明文连接、数据传输有特征字符：</p>
<p>通过特征字符，可以判断处于挖矿任务处于哪个阶段</p>
<p>第一阶段——客户机终端连接矿池：连接矿池的序号id（连接矿池的序号）、jasonrpc（连接矿池的协议）、<strong>method</strong>（连接矿池的方法）</p>
<p>第二阶段——接收到信息的矿池： jsonrps、status（连接矿池的状态）、job-id（挖矿任务的需要）</p>
<p>第三阶段——终端向矿池确认挖矿任务：id，jasonrpc，job{job-id}，XMING（交互的协议）</p>
<p>其中，只有第一、三阶段有id这个特征字符。</p>
<h4 id="网页挖矿"><a href="#网页挖矿" class="headerlink" title="网页挖矿"></a>网页挖矿</h4><p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/50.png" alt></p>
<p>服务器被植入了js代码（清除恶意代码），断开连接后，终端可以不做任何处理（未中招）</p>
<p>特征在于触发的是url类告警，使用http、https协议，真正中招的是服务器</p>
<h4 id="软件挖矿"><a href="#软件挖矿" class="headerlink" title="软件挖矿"></a>软件挖矿</h4><p>安装软件去挖矿，既有网页挖矿的特征，又有终端挖矿的特征</p>
<h2 id="3-6勒索病毒"><a href="#3-6勒索病毒" class="headerlink" title="3.6勒索病毒"></a>3.6勒索病毒</h2><p>修复文件、修复数据。（预防大于修复）</p>
<p>中招方式</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/47.png" alt></p>
<p>处理</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/47.png" alt></p>
<h2 id="3-7威胁情报及IOC"><a href="#3-7威胁情报及IOC" class="headerlink" title="3.7威胁情报及IOC"></a>3.7威胁情报及IOC</h2><h3 id="威胁情报"><a href="#威胁情报" class="headerlink" title="威胁情报"></a>威胁情报</h3><p>威胁情报指的是威胁资产的情报信息</p>
<h4 id="常见的威胁情报平台"><a href="#常见的威胁情报平台" class="headerlink" title="常见的威胁情报平台"></a>常见的威胁情报平台</h4><p>奇安信ti平台：<a target="_blank" rel="noopener" href="https://ti.qianxin.com/">https://ti.qianxin.com/</a></p>
<p>微步：<a target="_blank" rel="noopener" href="https://x.threatbook.com/">https://x.threatbook.com/</a></p>
<p>360：<a target="_blank" rel="noopener" href="https://ti.360.net/#/homepage">https://ti.360.net/#/homepage</a></p>
<p>（1）通过ti平台、微步、360查看有效性(最近看到、注册日期、过期时间)，排除由时效性带来的误报。【若两个及以上平台都显示未过期，说明当前域名还有时效性】</p>
<p>（2）若目前在有效期内，继续通过标签分析关联性（传播特征、网络行为特征） </p>
<h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><p>是一个指标，指的是主机或网络失陷的特征。常见的IOC分为五类：域名、IP、IP+端口、MD5值、URL。</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/51.png" alt></p>
<p>IOC四个特征：</p>
<p>场景性（不同场景下触发的IOC不同，其中域名类IOC触发最多，ip不可时常换，但是域名可以）</p>
<p>时效性（恶意样本被清除，导致失效；域名和ip相互绑定，域名已经过期，导致ip地址出现变更，也会导致失效）</p>
<p>针对性（某些恶意样本只针对特定的平台）</p>
<p>关联性（IOC之间具有关联性，通过分析关联性，可以得到网络特征与传播特征）</p>
<h4 id="练习一-7"><a href="#练习一-7" class="headerlink" title="练习一"></a>练习一</h4><p>查询域名：hot.tenchier.com</p>
<p>首先排除由时效性带来的误报，先看“最近看到”时间，发现“情报标签”显示C2，C2是远控木马：</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/112-16958184527941.png" alt></p>
<p>再关注一下上图的“过期时间“，说明在有效期内</p>
<p>也可以到微步平台看一下其有效期：</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/113.png" alt></p>
<p>通过两个平台确认样本在有效期内，接下来通过其标签排查关联性</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/114.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/115.png" alt></p>
<p>说明会进行终端挖矿，挖矿的特征有：</p>
<p>（1）进行域名解析</p>
<p>（2）与域名解析的结果建立tcp明文连接</p>
<p>（3）建立连接进行数据交互时，会产生特征字符（id、jasonrpc等）</p>
<p>在标签中还发现了CC服务器，代表远控木马，特征在于：</p>
<p>（1）进行域名解析</p>
<p>（2）与域名解析的结果建立tcp密文连接进行数据交互</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/116.png" alt></p>
<p>由此找到了扩散特征</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/117.png" alt></p>
<p>通过redis方式获取服务器权限，植入木马</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/118.png" alt></p>
<p>由此，了解入侵方式（Minerd标签）、网络行为特征（确定是挖矿还是远控木马）、扩散特征（LifeCalendarWorm标签）等。关联性分析总结：</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/52.png" alt></p>
<h4 id="练习二-3"><a href="#练习二-3" class="headerlink" title="练习二"></a>练习二</h4><p>查询域名：rer.njaavfxcgk3.club</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/119-16958216606014.png" alt></p>
<p>C2为远控木马</p>
<p>到其他平台查看：</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/120-16958214902383.png" alt></p>
<p>发现时间较远</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/12-16958217860065-16958217938986.png" alt></p>
<p>确定在有效期内后，继续通过标签排查关联性。了解别名CNAME、入侵方式、网络行为特征、扩散特征：</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/54-16958223342019.png" alt></p>
<p>注：NSA武器库是利用常见端口进行攻击的武器库，常见工具为永恒之蓝。</p>
<p>在该详情中找到CNAME和扩散方式：利用永恒之蓝ms17-010的445端口进行横向扩散</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/55.png" alt></p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/56.png" alt="56"></p>
<p>找到新的扩散方式</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/121.png" alt></p>
<p>换一个平台</p>
<p><img src="/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/122.png" alt></p>
<p>总结：</p>
<p>1.网络行为特征（挖矿、cc域名）</p>
<p>（1）域名解析：域名形似DGA域名（二级域名较为类似）</p>
<p>（2）与域名解析的结果进行交互（CC服务器），TCP密文建立连接</p>
<p>（3）连接的矿池的ip（挖矿）</p>
<p>2.扩散特征</p>
<p>（1）利用ms17-010永恒之蓝 smb协议 445端口</p>
<p>（2）利用ssh/telnet进行暴力破解</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2023/09/18/cfs%E9%9D%B6%E5%9C%BA/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="Update time"></i>
              2023-09-24 08:12:56
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2023/09/25/%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB%EF%BC%88XSS%EF%BC%89/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E5%A4%A9%E7%9C%BC"><span class="toc-text">1天眼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">产品介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A8%81%E8%83%81%E6%A3%80%E6%B5%8B%E6%9C%BA%E5%88%B6%E4%B8%8E%E6%97%A5%E5%BF%97%E7%95%99%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-text">威胁检测机制与日志留存机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-text">架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E4%BC%A0%E6%84%9F%E5%99%A8%E3%80%90%E6%8E%A2%E9%92%88%E3%80%91"><span class="toc-text">流量传感器【探针】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%A8%81%E8%83%81%E9%89%B4%E5%AE%9A%E5%99%A8%E3%80%90%E6%B2%99%E7%AE%B1%E3%80%91"><span class="toc-text">文件威胁鉴定器【沙箱】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0"><span class="toc-text">分析平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E7%A1%AC%E4%BB%B6"><span class="toc-text">三个硬件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8"><span class="toc-text">注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-text">部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E6%97%A5%E5%BF%97%E6%A3%80%E7%B4%A2%E8%AF%AD%E6%B3%95"><span class="toc-text">2日志检索语法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2%E8%AF%AD%E6%B3%95"><span class="toc-text">2.1基本搜索语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80"><span class="toc-text">练习一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C"><span class="toc-text">练习二</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E9%AB%98%E7%BA%A7%E6%A3%80%E7%B4%A2"><span class="toc-text">2.2高级检索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-text">2.2.1通配符</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-1"><span class="toc-text">练习一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C-1"><span class="toc-text">练习二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2%E8%8C%83%E5%9B%B4%E6%A3%80%E7%B4%A2"><span class="toc-text">2.2.2范围检索</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-2"><span class="toc-text">练习一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C-2"><span class="toc-text">练习二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2"><span class="toc-text">2.2.3模糊搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4%E8%BF%91%E4%BC%BC%E6%90%9C%E7%B4%A2"><span class="toc-text">2.2.4近似搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5%E6%AD%A3%E5%88%99%E6%90%9C%E7%B4%A2%E3%80%81%E8%BD%AC%E4%B9%89%E6%90%9C%E7%B4%A2%E3%80%81%E4%BA%8C%E7%BA%A7%E6%A3%80%E7%B4%A2"><span class="toc-text">2.2.5正则搜索、转义搜索、二级检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%E5%AD%97%E6%AE%B5"><span class="toc-text">2.3字段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5"><span class="toc-text">网络协议公共字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-3"><span class="toc-text">练习一</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP"><span class="toc-text">UDP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS"><span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="toc-text">文件传输协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-text">HTTP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E5%8D%8F%E8%AE%AE"><span class="toc-text">SSL协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E5%8D%8F%E8%AE%AE"><span class="toc-text">邮件协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-4"><span class="toc-text">练习一</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8D%8F%E8%AE%AE"><span class="toc-text">登录协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-5"><span class="toc-text">练习一</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-text">数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-6"><span class="toc-text">练习一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C-%E5%85%AD"><span class="toc-text">练习二-六</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">3基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.1网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-text">OSI七层网络模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-IP%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="toc-text">TCP&#x2F;IP五层模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2NAT%E5%8D%8F%E8%AE%AE"><span class="toc-text">3.2NAT协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3web%E6%9E%B6%E6%9E%84"><span class="toc-text">3.3web架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4%E5%AF%86%E7%A0%81%E7%BC%96%E7%A0%81%E5%AD%A6%EF%BC%88%E5%8A%A0%E5%AF%86%EF%BC%89"><span class="toc-text">3.4密码编码学（加密）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5%E6%9C%A8%E9%A9%AC"><span class="toc-text">3.5木马</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E6%8E%A7%E6%9C%A8%E9%A9%AC"><span class="toc-text">远控木马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC"><span class="toc-text">挖矿木马</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%96%E7%9F%BF%E6%96%B9%E5%BC%8F%E5%8F%8A%E4%BA%A4%E4%BA%92%E7%89%B9%E5%BE%81"><span class="toc-text">挖矿方式及交互特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%88%E7%AB%AF%E6%8C%96%E7%9F%BF"><span class="toc-text">终端挖矿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E9%A1%B5%E6%8C%96%E7%9F%BF"><span class="toc-text">网页挖矿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E6%8C%96%E7%9F%BF"><span class="toc-text">软件挖矿</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92"><span class="toc-text">3.6勒索病毒</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%E5%8F%8AIOC"><span class="toc-text">3.7威胁情报及IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5"><span class="toc-text">威胁情报</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%E5%B9%B3%E5%8F%B0"><span class="toc-text">常见的威胁情报平台</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOC"><span class="toc-text">IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%B8%80-7"><span class="toc-text">练习一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E4%BA%8C-3"><span class="toc-text">练习二</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="facebook" href="">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" href="">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="wechat" href="">
            <i class="iconfont icon-wechat"></i>
          </a>
        </li>
      
        <li>
          <a title="weibo" href="">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © Oranges 2021</a>
        
    </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + %E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87 + '&url=' + http%3A%2F%2Fyy-ll.github.io%2F2023%2F09%2F24%2F%25E5%2585%25A5%25E4%25BE%25B5%25E6%25A3%2580%25E6%25B5%258B%25E8%25AE%25BE%25E5%25A4%2587%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://yy-ll.github.io/2023/09/24/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
